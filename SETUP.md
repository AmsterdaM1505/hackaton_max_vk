# üìö –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é PostgreSQL

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL

#### –ù–∞ macOS (—Å Homebrew):
```bash
brew install postgresql
brew services start postgresql
```

#### –ù–∞ Ubuntu/Debian:
```bash
sudo apt-get install postgresql postgresql-contrib
sudo systemctl start postgresql
```

#### –ù–∞ Windows:
–°–∫–∞—á–∞–π –∏ —É—Å—Ç–∞–Ω–æ–≤–∏ —Å https://www.postgresql.org/download/windows/

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ PostgreSQL
psql -U postgres

# –°–æ–∑–¥–∞–π –ë–î
CREATE DATABASE dating_bot_db;

# –°–æ–∑–¥–∞–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
CREATE USER bot_user WITH PASSWORD 'secure_password';
ALTER ROLE bot_user SET client_encoding TO 'utf8';
ALTER ROLE bot_user SET default_transaction_isolation TO 'read committed';
ALTER ROLE bot_user SET default_transaction_deferrable TO on;
ALTER ROLE bot_user SET timezone TO 'UTC';

# –í—ã–¥–∞–π –ø—Ä–∞–≤–∞
GRANT ALL PRIVILEGES ON DATABASE dating_bot_db TO bot_user;

# –í—ã—Ö–æ–¥
\q
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Python

```bash
pip install -r requirements.txt
```

### 4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:

```bash
cp .env.example .env
```

–í —Ñ–∞–π–ª–µ `.env` —É–∫–∞–∂–∏:

```
# –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–∑ MAX
BOT_TOKEN=your_max_api_token_here

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã PostgreSQL
DB_HOST=localhost
DB_PORT=5432
DB_NAME=dating_bot_db
DB_USER=postgres           # –∏–ª–∏ bot_user –µ—Å–ª–∏ —Ç—ã —Å–æ–∑–¥–∞–≤–∞–ª –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ
DB_PASSWORD=postgres       # –∏–ª–∏ —Å–≤–æ–π –ø–∞—Ä–æ–ª—å
```

–ü–æ–ª—É—á–∏ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–∞ https://dev.max.ru/

### 5. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

–¢–∞–±–ª–∏—Ü—ã –ë–î **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è** –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞:

```bash
python main.py
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL

–¢–∞–±–ª–∏—Ü—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î (`database.py`):

```
users                  - –ø—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ user_id           - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID (TEXT PRIMARY KEY)
‚îú‚îÄ‚îÄ username          - –Ω–∏–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (TEXT)
‚îú‚îÄ‚îÄ name              - –∏–º—è (TEXT)
‚îú‚îÄ‚îÄ age               - –≤–æ–∑—Ä–∞—Å—Ç (INTEGER)
‚îú‚îÄ‚îÄ gender            - –ø–æ–ª (TEXT: male/female)
‚îú‚îÄ‚îÄ bio               - –æ–ø–∏—Å–∞–Ω–∏–µ (TEXT)
‚îú‚îÄ‚îÄ categories        - –∏–Ω—Ç–µ—Ä–µ—Å—ã (JSONB) ‚Üê PostgreSQL native JSON
‚îú‚îÄ‚îÄ created_at        - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è (TIMESTAMP)
‚îî‚îÄ‚îÄ updated_at        - –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (TIMESTAMP)

likes                 - –≤–∑–∞–∏–º–Ω—ã–µ –ª–∞–π–∫–∏
‚îú‚îÄ‚îÄ id               - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
‚îú‚îÄ‚îÄ user_from        - –∫—Ç–æ –ø–æ—Å—Ç–∞–≤–∏–ª –ª–∞–π–∫
‚îú‚îÄ‚îÄ user_to          - –∫–æ–º—É –ø–æ—Å—Ç–∞–≤–∏–ª –ª–∞–π–∫
‚îî‚îÄ‚îÄ created_at       - –¥–∞—Ç–∞ –ª–∞–π–∫–∞

dislikes             - –¥–∏–∑–ª–∞–π–∫–∏ (–∏—Å–∫–ª—é—á–∏—Ç—å –∏–∑ –ø–æ–∏—Å–∫–∞)
‚îú‚îÄ‚îÄ id               - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
‚îú‚îÄ‚îÄ user_from        - –∫—Ç–æ –ø–æ—Å—Ç–∞–≤–∏–ª –¥–∏–∑–ª–∞–π–∫
‚îú‚îÄ‚îÄ user_to          - –∫–æ–º—É –ø–æ—Å—Ç–∞–≤–∏–ª –¥–∏–∑–ª–∞–π–∫
‚îî‚îÄ‚îÄ created_at       - –¥–∞—Ç–∞ –¥–∏–∑–ª–∞–π–∫–∞

messages             - —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–∞—Ö
‚îú‚îÄ‚îÄ id               - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
‚îú‚îÄ‚îÄ from_user        - –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å
‚îú‚îÄ‚îÄ to_user          - –ø–æ–ª—É—á–∞—Ç–µ–ª—å
‚îú‚îÄ‚îÄ message          - —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
‚îú‚îÄ‚îÄ created_at       - –¥–∞—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
‚îî‚îÄ‚îÄ is_read          - –ø—Ä–æ—á–∏—Ç–∞–Ω–æ –ª–∏

blocked_chats        - –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —á–∞—Ç—ã
‚îú‚îÄ‚îÄ id               - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
‚îú‚îÄ‚îÄ user1_id         - –ø–µ—Ä–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
‚îú‚îÄ‚îÄ user2_id         - –≤—Ç–æ—Ä–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
‚îî‚îÄ‚îÄ created_at       - –¥–∞—Ç–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

notifications        - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–ª–∞–π–∫–∏, –º—ç—Ç—á–∏)
‚îú‚îÄ‚îÄ id               - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
‚îú‚îÄ‚îÄ user_id          - –ø–æ–ª—É—á–∞—Ç–µ–ª—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ from_user_id     - –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å –¥–µ–π—Å—Ç–≤–∏—è
‚îú‚îÄ‚îÄ from_user_name   - –∏–º—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
‚îú‚îÄ‚îÄ from_user_username - –Ω–∏–∫ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
‚îú‚îÄ‚îÄ notification_type - —Ç–∏–ø (like, match)
‚îú‚îÄ‚îÄ message          - —Ç–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ is_read          - –ø—Ä–æ—á–∏—Ç–∞–Ω–æ –ª–∏
‚îî‚îÄ‚îÄ created_at       - –¥–∞—Ç–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

user_states          - —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îú‚îÄ‚îÄ user_id          - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îú‚îÄ‚îÄ state            - —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (ENTER_NAME, IN_CHAT –∏ —Ç.–¥.)
‚îú‚îÄ‚îÄ data             - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (JSON)
‚îî‚îÄ‚îÄ updated_at       - –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
```

---

## üîß –ú–µ—Ç–æ–¥—ã Database API

### –†–∞–±–æ—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

```python
from database import db

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
db.user_exists(user_id: str) -> bool

# –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
db.get_user(user_id: str) -> Dict | None

# –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
db.create_user(
    user_id: str,
    username: str,
    name: str,
    age: int,
    gender: str,      # 'male' –∏–ª–∏ 'female'
    bio: str,
    categories: List[str]  # ['love', 'friendship', ...]
) -> bool

# –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
db.update_user(user_id: str, **kwargs) -> bool
```

### –õ–∞–π–∫–∏ –∏ –º—ç—Ç—á–∏

```python
# –î–æ–±–∞–≤–∏—Ç—å –ª–∞–π–∫
db.add_like(user_from: str, user_to: str) -> bool

# –î–æ–±–∞–≤–∏—Ç—å –¥–∏–∑–ª–∞–π–∫
db.add_dislike(user_from: str, user_to: str) -> bool

# –ü–æ–ª—É—á–∏—Ç—å –≤–∑–∞–∏–º–Ω—ã–µ –ª–∞–π–∫–∏ (–º—ç—Ç—á–∏)
db.get_matches(user_id: str) -> List[str]  # –°–ø–∏—Å–æ–∫ user_id

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
db.has_interacted(user_from: str, user_to: str) -> bool
```

### –°–æ–æ–±—â–µ–Ω–∏—è

```python
# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
db.save_message(from_user: str, to_user: str, message: str) -> bool

# –ü–æ–ª—É—á–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –º–µ–∂–¥—É –¥–≤—É–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
db.get_messages(user1: str, user2: str, limit: int = 10) -> List[Dict]
```

### –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —á–∞—Ç–æ–≤

```python
# –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —á–∞—Ç (–æ–±–æ—é–¥–Ω–æ)
db.block_chat(user1_id: str, user2_id: str) -> bool

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –ª–∏ —á–∞—Ç
db.is_chat_blocked(user1_id: str, user2_id: str) -> bool

# –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —á–∞—Ç
db.unblock_chat(user1_id: str, user2_id: str) -> bool
```

### –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (FSM)

```python
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
db.set_user_state(user_id: str, state: str, data: Dict = None) -> bool

# –ü–æ–ª—É—á–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
db.get_user_state(user_id: str) -> Tuple[str, Dict]
# Returns: (state, data)

# –û—á–∏—Å—Ç–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
db.clear_user_state(user_id: str) -> None
```

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

```python
# –î–æ–±–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
db.add_notification(
    user_id: str,
    from_user_id: str,
    from_user_name: str,
    from_user_username: str,
    notification_type: str,  # 'like' –∏–ª–∏ 'match'
    message: str = None
) -> bool

# –ü–æ–ª—É—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
db.get_notifications(user_id: str, unread_only: bool = False) -> List[Dict]

# –ü–æ–ª—É—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö
db.get_unread_notifications_count(user_id: str) -> int

# –û—Ç–º–µ—Ç–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
db.mark_notification_as_read(notification_id: int) -> bool

# –û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
db.mark_all_notifications_as_read(user_id: str) -> bool
```

---

## üìù –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–¥–µ

```python
from database import db
from states import UserState

# –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user_id = "12345"
db.create_user(
    user_id=user_id,
    username="john_doe",
    name="John",
    age=25,
    gender="male",
    bio="–õ—é–±–ª—é –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –∏ –∫–æ—Ñ–µ",
    categories=["love", "friendship"]
)

# –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
user = db.get_user(user_id)
print(f"–ò–º—è: {user['name']}, –í–æ–∑—Ä–∞—Å—Ç: {user['age']}")

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM
db.set_user_state(user_id, UserState.VIEWING_PROFILE.value, {
    'current_profile': {'user_id': 'other_user', 'name': 'Alice'},
    'category': 'love'
})

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–∞–π–∫–∞
db.add_like("12345", "67890")

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º—ç—Ç—á–∞
matches = db.get_matches("12345")
if "67890" in matches:
    print("üíï –í–∑–∞–∏–º–Ω–∞—è —Å–∏–º–ø–∞—Ç–∏—è!")

# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
db.save_message("12345", "67890", "–ü—Ä–∏–≤–µ—Ç!")

# –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —á–∞—Ç–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–µ—Ä–≤–∞—Ç—å –æ–±—â–µ–Ω–∏–µ)
db.block_chat("12345", "67890")
```

---

## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
python main.py
```

–ë–æ—Ç –Ω–∞—á–Ω—ë—Ç —Å–ª—É—à–∞—Ç—å –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã.

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–π —Å–∫—Ä–∏–ø—Ç `create_test_users.py` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

```bash
python create_test_users.py
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π —Å —Ä–∞–∑–Ω—ã–º–∏ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º–∏, –∫–æ—Ç–æ—Ä—ã—Ö –º–æ–∂–Ω–æ –ª–∞–π–∫–∞—Ç—å –∏ —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –º–æ–∂–Ω–æ –æ–±—â–∞—Ç—å—Å—è.

**–¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:**
- Alice (25 –ª–µ—Ç, –∂–µ–Ω—â–∏–Ω–∞) - –∏–Ω—Ç–µ—Ä–µ—Å—ã: love, friendship
- Bob (28 –ª–µ—Ç, –º—É–∂—á–∏–Ω–∞) - –∏–Ω—Ç–µ—Ä–µ—Å—ã: love
- Charlie (30 –ª–µ—Ç, –º—É–∂—á–∏–Ω–∞) - –∏–Ω—Ç–µ—Ä–µ—Å—ã: friendship, hobby
- Diana (23 –≥–æ–¥–∞, –∂–µ–Ω—â–∏–Ω–∞) - –∏–Ω—Ç–µ—Ä–µ—Å—ã: love, hobby

---

## üêõ –û—Ç–ª–∞–¥–∫–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–î

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ë–î —á–µ—Ä–µ–∑ psql

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ –ë–î
psql -U postgres dating_bot_db

# –ü–æ—Å–º–æ—Ç—Ä–∏ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
SELECT user_id, name, age, gender FROM users;

# –ü–æ—Å–º–æ—Ç—Ä–∏ –ª–∞–π–∫–∏
SELECT user_from, user_to FROM likes;

# –í—ã—Ö–æ–¥
\q
```

### –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–æ–ø–∞—Å–Ω–æ!)

```bash
psql -U postgres dating_bot_db
TRUNCATE TABLE users CASCADE;
\q
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ë–î –∏–∑ Python

```python
from database import db

# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
conn = db.get_connection()
cursor = conn.cursor()
cursor.execute("SELECT user_id, name, age FROM users LIMIT 10")
users = cursor.fetchall()
for user in users:
    print(user)
cursor.close()
conn.close()
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î

```python
from config import DATABASE_URL
import psycopg2

try:
    conn = psycopg2.connect(DATABASE_URL)
    print("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —É—Å–ø–µ—à–Ω–æ!")
    conn.close()
except Exception as e:
    print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: {e}")
```

---

## üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –¥–æ—Å—Ç—É–ø–Ω—ã:

- `/menu` - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- `/view_profile` - –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å
- `/browse` - –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∞–Ω–∫–µ—Ç—ã –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö
- `/like` - –õ–∞–π–∫–Ω—É—Ç—å –∞–Ω–∫–µ—Ç—É
- `/dislike` - –î–∏–∑–ª–∞–π–∫–Ω—É—Ç—å –∞–Ω–∫–µ—Ç—É
- `/skip` - –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∫–µ—Ç—É
- `/messages` - –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º—ç—Ç—á–∏ –∏ —á–∞—Ç—ã
- `/chat_<user_id>` - –ù–∞—á–∞—Ç—å —á–∞—Ç —Å —á–µ–ª–æ–≤–µ–∫–æ–º
- `/stop_chat` - –ü—Ä–µ—Ä–≤–∞—Ç—å —á–∞—Ç (–±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–µ—Ä–µ–ø–∏—Å–∫—É –æ–±–æ—é–¥–Ω–æ)
- `/likes` - –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫—Ç–æ –ª–∞–π–∫–Ω—É–ª
- `/notifications` - –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `/edit` - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å

---

## üí° –°–æ–≤–µ—Ç—ã –ø–æ —Ä–∞–±–æ—Ç–µ —Å PostgreSQL

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ PostgreSQL –Ω–∞–¥ SQLite:
- ‚úÖ **JSONB** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ JSON —Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–µ–π (–±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º)
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- ‚úÖ **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å** - ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è, –±—ç–∫–∞–ø—ã
- ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –ª—É—á—à–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ **–ò–Ω–¥–µ–∫—Å—ã** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω—ã –¥–ª—è –≤—Å–µ—Ö –≤–∞–∂–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫

### –°–æ–≤–µ—Ç—ã –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:

1. **user_id —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ (str)** –≤ –ë–î, –Ω–æ –∏–∑ maxapi –ø—Ä–∏—Ö–æ–¥–∏—Ç –∫–∞–∫ int. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π: `str(event.message.sender.user_id)`

2. **–°–æ—Å—Ç–æ—è–Ω–∏—è FSM** –ø–æ–º–æ–≥–∞—é—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å, –Ω–∞ –∫–∞–∫–æ–º —ç—Ç–∞–ø–µ –¥–∏–∞–ª–æ–≥–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

3. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —á–∞—Ç–æ–≤** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–∫–ª—é—á–∞–µ—Ç –¥–∞–ª—å–Ω–µ–π—à–µ–µ –æ–±—â–µ–Ω–∏–µ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

4. **JSONB –ø–æ–ª—è** (categories, data) –∏–º–µ—é—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞:
   - `categories @> '["love"]'::jsonb` - –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–ª–∏—á–∏—é –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

5. **–ò–Ω–¥–µ–∫—Å—ã** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
   - –õ–∞–π–∫–∏, –¥–∏–∑–ª–∞–π–∫–∏, —Å–æ–æ–±—â–µ–Ω–∏—è, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è - –≤—Å—ë –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ

### –ú–∏–≥—Ä–∞—Ü–∏—è –∏–∑ SQLite –≤ PostgreSQL:

–ï—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ SQLite:

```bash
# 1. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π –¥–∞–Ω–Ω—ã–µ –∏–∑ SQLite
sqlite3 dating_bot.db ".dump" > backup.sql

# 2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π –≤ PostgreSQL (—Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ SQL —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞)
# –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ETL –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏–ª–∏ –Ω–∞–ø–∏—Å–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
```

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-11-08
